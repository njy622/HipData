{% extends "base.html" %}
{% block title %}소비패턴에 따른 녹색금융 추천{% endblock %}
{% block additional_head %}

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<title>Receipt</title>
<script type="text/javascript">
    $(function () {
        $("#container").scrollTop($("#container")[0].scrollHeight);
    });

</script>
<script>
    $(document).ready(function () {
        $("#uploadForm").on("submit", function (e) {
            e.preventDefault();
            let mark = "mark" + Date.now();
            $.ajax({
                url: "/chatbot/receipt",
                type: "POST",
                data: new FormData(this),
                processData: false,
                contentType: false,
                success: function (result) {
                    $("<div></div>")
                        .attr({ class: "d-flex flex-row mt-1", id: mark + "1" })
                        .appendTo("#container");
                    $("<div></div>")
                        .attr({ class: "card w-75", id: mark + "2" })
                        .appendTo("#" + mark + "1");
                    $("<div></div>")
                        .attr({ class: "card-body", id: mark + "3" })
                        .appendTo("#" + mark + "2");
                    $("<img></img>")
                        .attr({ src: "{{url_for('static', filename='img/person.png')}}", height: "32" })
                        .appendTo("#" + mark + "3");
                    $("<span></span>")
                        .text(" 업로드 완료!!")
                        .appendTo("#" + mark + "3");
                    $("<hr></hr>").appendTo("#" + mark + "3");
                    $("<div></div>")
                        .attr({ class: "d-flex flex-row mt-1", id: mark + "1" })
                        .appendTo("#container");
                    $("<div></div>")
                        .attr({ class: "card w-75", id: mark + "2" })
                        .appendTo("#" + mark + "1");
                    $("<div></div>")
                        .attr({ class: "card-body", id: mark + "3" })
                        .appendTo("#" + mark + "2");
                    $("<img></img>")
                        .attr({ src: "{{url_for('static', filename='img/ai.png')}}", height: "32" })
                        .appendTo("#" + mark + "3");
                    $("<span></span>")
                        .text(result)
                        .appendTo("#" + mark + "3");
                },
                error: function (xhr, status, error) {
                    $("#message").text(error);
                },
            });
        });
    });
</script>
<script>
    function send() {
        let userInput = $("#userInput").val();
        $("#userInput").val("");
        let mark = "mark" + Date.now();
        $.ajax({
            type: "POST",
            url: "/receipt2",
            data: { userInput: userInput },
            success: function (result) {
                let combinedString = "";
                let obj = JSON.parse(result);
                obj.forEach(function (element) {
                    combinedString += element + ", ";
                });
                combinedString = combinedString.replace(/,\s*$/, "");
                $("<div></div>")
                    .attr({ class: "d-flex flex-row mt-1", id: mark + "1" })
                    .appendTo("#container");
                $("<div></div>")
                    .attr({ class: "card w-75", id: mark + "2" })
                    .appendTo("#" + mark + "1");
                $("<div></div>")
                    .attr({ class: "card-body", id: mark + "3" })
                    .appendTo("#" + mark + "2");
                $("<img></img>")
                    .attr({ src: "{{url_for('static', filename='img/person.png')}}", height: "32" })
                    .appendTo("#" + mark + "3");
                $("<span></span>")
                    .text(" " + userInput)
                    .appendTo("#" + mark + "3");
                $("<hr></hr>").appendTo("#" + mark + "3");
                $("<div></div>")
                    .attr({ class: "d-flex flex-row-reverse mt-1", id: mark + "6" })
                    .appendTo("#container");
                $("<div></div>")
                    .attr({ class: "card bg-light text-dark w-75", id: mark + "7" })
                    .appendTo("#" + mark + "6");
                $("<div></div>")
                    .attr({ class: "card-body text-end", id: mark + "8" })
                    .appendTo("#" + mark + "7");
                $("<span></span>")
                    .text(combinedString + "\n")
                    .appendTo("#" + mark + "8");
                $("<img></img>")
                    .attr({ src: "{{url_for('static', filename='img/ai.png')}}", height: "32" })
                    .appendTo("#" + mark + "8");
                $("<hr></hr>").appendTo("#" + mark + "8");
            },
        });
    }
</script>


 
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <link rel="stylesheet" href="style.css">
    
    <script>
        
        function send() {
            
            let userInput = $('#userInput').val();
            $('#userInput').val('');
            let mark = 'mark' + Date.now();
            
            $.ajax({
                type: 'POST',
                url: '/chatbot/counsel',
                data: {userInput: userInput},
                success: function(result) {
                    let obj = JSON.parse(result);
					$('<div></div>')
							.attr({'class': 'd-flex flex-row mt-1', id: mark+'1'})
							.appendTo('#container');
                        $('<img></img>')
                        .attr({src: "{{url_for('static', filename='img/person.png')}}", height: '50', class:'m-3'}).appendTo('#'+mark+'1');    
						$('<div></div>')
							.attr({'class': 'card w-100  text-dark', id: mark+'2'}).appendTo('#'+mark+'1');
                            $('<div></div>')
							.attr({'class': 'card-body w-50', id: mark+'3'}).appendTo('#'+mark+'2');
                            $('<span></span>')
							.text(' '+obj.user).appendTo('#'+mark+'3');
                            $('<div></div>')
							.attr({'class': 'd-flex flex-row-reverse mt-1', id: mark+'6'})
							.appendTo('#container');
                            $('<div></div>')
                                .attr({'class': 'card bg-success text-white m-3', id: mark+'7'}).appendTo('#'+mark+'6');
                                $('<div></div>')
                                .attr({'class': 'card-body text-end ', id: mark+'8'}).appendTo('#'+mark+'7');
                            $('<span></span>')
                                .text(obj.chatbot+' ').appendTo('#'+mark+'8');
                            /* $('<img></img>')
                            .attr({src: "{{url_for('static', filename='img/ai.png')}}", height: '50', class:'mt-4',style: 'float: right'}).appendTo('#'+mark+'8');
                               */         
                    }
           
            
            });
        }
        
 

    </script> 
{% endblock %}
{% block subtitle %}소비패턴에 따른 녹색금융 추천{% endblock %}
{% block content %}

<!-- <div class="d-flex justify-content-center" style="margin-bottom: 60px">
    <div class="container" id="container" style="width: 300px; height: 500px; border: 1px solid; overflow: auto">
        <div class="d-flex flex-row mt-1">
            <div class="card w-75">
                <div class="card-body">
                    <img src="../static/img/ai.png" height="32" />
                    <span>영수증 업로드?</span>
                    <form id="uploadForm" enctype="multipart/form-data" method="POST">
                        <input type="hidden" name="MAX_FILE_SIZE" value="300000" />
                        <input type="file" name="image" accept="image/*" />
                        <input type="submit" value="upload" />
                    </form>
                    <div id="message"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="d-flex justify-content-center">
    <div class="input-group mb-3" style="width: 300px; height: 100px; border: 1px solid">
        <span class="input-group-text">당신:</span>
        <input type="text" class="form-control" name="userInput" id="userInput" onkeyup="if(window.event.keyCode==13) {send()}" />
        <button class="btn btn-primary" type="submit" onclick="send()">전송</button>
    </div>
</div>
 -->



<div class="d-flex justify-content-center">
    <div class="input-group mb-3 outer-container" style="width: 100%;">
        <span class="input-group-text"><img src="../static/img/ai.png" height="32" /></span>
        <input type="text" class="form-control" name="userInput" id="userInput"
        onkeyup="if(window.event.keyCode==13) {send()}" 
        onfocus="if(this.value=='안녕하세요~ 녹색금융 챗봇 그린이 입니다. 원하는 질문을 적어보세요.') { this.value=''; this.style.opacity = 1; }"
        onblur="if(this.value=='') { this.value='안녕하세요~ 녹색금융 챗봇 그린이 입니다. 원하는 질문을 적어보세요.'; this.style.opacity = 0.7; }"
        placeholder="안녕하세요~ 녹색금융 챗봇 그린이 입니다. 원하는 질문을 적어보세요.">
        <button class="btn btn-success" type="submit" onclick="send()">전송</button>
            
    </div>
</div>
<div class="d-flex justify-content-left" style="margin-bottom: 60px ">
    
    <div class="container" id="container" 
            style=" padding-right: 250px; color: #0a703a; width: 1000px; height: 500px; border: 4px solid; border-radius: 30px; overflow: auto">
        <div class="mt-3 mb-3">
            <a href="/crawling/bank"><button class="btn btn-success">은행상품 안내 바로가기</button></a>
            <a href="/crawling/finance"><button class="btn btn-success ">투자상품 안내 바로가기</button></a>
            <a href="/crawling/card"><button class="btn btn-success ">그린카드 안내 바로가기</button></a>
        </div>
        <div class="d-flex flex-row mt-1">
            <div class="card w-100">
                <div class="card-body">        
                    <span style="color: black; font-size: 20px;">영수증을 업로드 하시겠습니까?</span>
                    <form  style="color: black; margin-top: 20px;"   id="uploadForm" enctype="multipart/form-data" method="POST">
                        <input type="hidden" name="MAX_FILE_SIZE" value="300000" />
                        <input type="file" name="image" accept="image/*" />
                        <input class="btn btn-sm btn-success margin-left-5" type="submit" value="upload" />
                    </form>
                    <div id="message"></div>
                </div>
            </div>
        </div>
    </div>
    <img src="../static/img/chatbot.png" style="
            position: absolute; right: 0px; top: 200px; z-index: 1; height: auto; width: 400px;" float: rightx; />
</div>






<!-- <input type="file" id="receiptInput"  accept="image/*" >
<button onclick="processReceipt()" class="btn btn-sm btn-outline-primary margin-left-5">Process Receipt</button>
<div id="result" onclick="receipt_get_point()"></div>
<div class="btn-group mb-3">
    <a class="dropdown-item" href="/crawling/bank"><button class="btn btn-primary ">은행상품 안내 바로가기</button></a>
    <a class="dropdown-item" href="/crawling/finance"><button class="btn btn-primary ">투자상품 안내 바로가기</button></a>
    <a class="dropdown-item" href="/crawling/card"><button class="btn btn-primary ">그린카드 안내 바로가기</button></a>
</div>
<div class="d-flex justify-content-center">
    <div class="input-group mb-3 outer-container" style="width: 100%;">
        <span class="input-group-text">당신:</span>
        <input type="text" class="form-control" name="userInput" id="userInput"
        onkeyup="if(window.event.keyCode==13) {send()}"
        onfocus="if(this.value=='무엇이든 물어보세요~ ^^') { this.value=''; this.style.opacity = 1; }"
        onblur="if(this.value=='') { this.value='무엇이든 물어보세요~ ^^'; this.style.opacity = 0.7; }"
        placeholder="무엇이든 물어보세요~ ^^">
        <button class="btn btn-primary" type="submit" onclick="send()">전송</button>
            
    </div>
</div>    
    
    <div class="d-flex justify-content-center" style="margin-bottom: 60px;">
        <div class="container overflow-auto" id="container" style="width: 80%; height: 600px;">
        </div>
    </div>
</div> -->
{% endblock %}